var getRecorder=function(){var i=new WeakMap;function d(e,t){e=i.get(e);if(void 0!==e)return e[t]}function a(e,t,r){var o=i.get(e);void 0===o&&(o={},i.set(e,o)),o[t]=r}function e(e){a(this,"canvasStream",document.querySelector(e.el).captureStream(e.fps)),a(this,"videoTrackSet",!1),a(this,"recording",!1),a(this,"videoEndCallback",e.callback),void 0===e.width||void 0===e.height?a(this,"videoSize",null):a(this,"videoSize",[e.width,e.height])}return e.prototype.start=function(){if(!d(this,"videoTrackSet"))return new Error("Video Track Not Set");var e=d(this,"recording");e?console.warn("Recording Now!!"):(a(this,"recording",!e),d(this,"mediaRecorder").start())},e.prototype.stop=function(){var e=d(this,"recording");if(!d(this,"videoTrackSet"))return new Error("Video Track Not Set");(e=d(this,"recording"))?(a(this,"recording",!e),d(this,"mediaRecorder").stop()):console.warn("Not Recording!!")},e.prototype.setupTrack=function(t){function r(){a(o,"videoTrackSet",!0);var e=new MediaRecorder(i);a(o,"mediaRecorder",e);var r=[];e.ondataavailable=function(e){r.push(e.data)},e.onstop=function(){console.log("Stopping recorder now...");var e=new Blob(r,{type:"video/mp4"}),t=URL.createObjectURL(e),e=document.createElement("video");e.src=t,"function"==typeof n&&n(e,t)},t()}var o=this,i=d(this,"canvasStream"),n=d(this,"videoEndCallback"),e=d(this,"videoSize"),c=i.getVideoTracks()[0],s={};null!==e&&(s={width:e[0],height:e[1]}),c.applyConstraints(s).then(function(){r()}).catch(function(e){console.log("Cannot set specific video size"),console.log(e),r()})},e.prototype.renderButton=function(e){if(!d(this,"videoTrackSet"))return new Error("Video Track Not Set");var t=this,r=d(this,"storedBtn");null!=r&&(a(this,"storedBtn",null),r.remove(),r=null);var o={recordBtnOuter:["position: absolute;","bottom: "+e.bottom+"%;","right: "+e.right+"%;","height: "+e.size+"px;","width: "+e.size+"px;","background-color: white;","border-style: solid;","border-radius: 50%;","border-color: red;","display: flex;","align-items: center;","justify-content: center;","cursor: pointer;"].join(""),recordBtn:["height: "+.8*e.size+"px;","width: "+.8*e.size+"px;","border-radius: 50%;","background-color: red;","display: flex;","align-items: center;","justify-content: center;","color: white;"].join(""),stopBtn:["height: "+.7*e.size+"px;","width: "+.7*e.size+"px;","display: flex;","align-items: center;","justify-content: center;","background-color: red;","color: white;"].join("")},e=document.createElement("div"),i=document.createElement("div");d(this,"recording");return e.style.cssText=o.recordBtnOuter,a(this,"storedBtn",e),i.style.cssText=o.recordBtn,i.innerText="REC",e.appendChild(i),e.onclick=function(){d(t,"recording")?(i.style.cssText="",i.style.cssText=o.recordBtn,i.innerText="REC",t.stop()):(i.style.cssText="",i.style.cssText=o.stopBtn,i.innerText="STOP",t.start())},e},e.prototype.getRecording=function(){return d(this,"recording")},e};